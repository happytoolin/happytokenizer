---
import { ModelTokenizer } from '../../components/react/ModelTokenizer';
import MainLayout from '../../layouts/MainLayout.astro';
import { getEncodingForModel } from '../../utils/modelEncodings';
import { getPricing, MODELS } from '../../utils/models';

// Generate static paths for all models
export async function getStaticPaths() {
  const paths = Object.entries(MODELS).map(([modelId, modelData]) => ({
    params: { model: modelId },
    props: {
      model: modelData,
      modelId: modelId
    }
  }));

  return paths;
}

const { model, modelId } = Astro.props;

// Generate SEO metadata
const pageTitle = `${model.displayName} Tokenizer - HappyTokenizer`;
const pageDescription = `Tokenize text with ${model.displayName}. View token counts, context window usage, and API costs. Real-time visualization with ${model.encoding} encoding.`;
const canonicalUrl = `https://happytokenizer.com/models/${modelId}`;

// Get pricing and encoding info
const pricing = getPricing(modelId);
const encodingType = getEncodingForModel(modelId);

// Generate structured data for SEO
const structuredData = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": `${model.displayName} Tokenizer`,
  "description": pageDescription,
  "url": canonicalUrl,
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": `${pricing.input * 1000}`,
    "priceCurrency": "USD",
    "description": "Input tokens per 1K tokens"
  },
  "featureList": [
    "Real-time tokenization",
    "Context window visualization",
    "Cost estimation",
    "Multiple view modes",
    "Privacy-focused processing"
  ]
};
---

<MainLayout
  title={pageTitle}
  description={pageDescription}
>
  <style>
    .model-header {
      background: linear-gradient(135deg, #FF6600 0%, #FF8800 100%);
      border-bottom: 2px solid #000;
    }

    .model-card {
      background: #fff;
      border: 2px solid #000;
      box-shadow: 4px 4px 0px #000;
    }

    .stat-card {
      background: #fff;
      border: 2px solid #000;
      transition: all 0.2s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 6px 6px 0px #000;
    }

  
    .pricing-highlight {
      background: #e6ffe6;
      border: 2px solid #00cc99;
    }
  </style>

  <!-- Structured Data for SEO -->
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)}></script>

  <div class="max-w-7xl mx-auto">
    <!-- Model Header -->
    <header class="model-header text-white p-8 mb-8">
      <div class="flex items-center justify-between">
        <div>
          <div class="flex items-center gap-4 mb-2">
            <a href="/models" class="text-white/80 hover:text-white transition-colors underline">
              ← Back to Models
            </a>
          </div>
          <h1 class="text-4xl font-bold font-display mb-2">{model.displayName}</h1>
          <p class="text-lg text-white/90">Tokenize text optimized for {model.displayName}</p>
        </div>
        <div class="text-right">
          <div class="bg-white/10 backdrop-blur-sm border-2 border-white/30 px-4 py-2 mb-2">
            <span class="text-sm font-mono font-bold text-white">{encodingType}</span>
          </div>
          <div class="text-sm text-white/80">Encoding Type</div>
        </div>
      </div>
    </header>

    <!-- Model Stats -->
    <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="stat-card p-6">
        <div class="text-sm text-gray-600 mb-1">Context Window</div>
        <div class="text-2xl font-bold font-mono">{model.contextWindow.toLocaleString()}</div>
        <div class="text-xs text-gray-500">tokens</div>
      </div>

      <div class="stat-card p-6">
        <div class="text-sm text-gray-600 mb-1">Input Cost</div>
        <div class="text-2xl font-bold font-mono">${(pricing.input * 1000).toFixed(2)}</div>
        <div class="text-xs text-gray-500">per 1K tokens</div>
      </div>

      <div class="stat-card p-6">
        <div class="text-sm text-gray-600 mb-1">Output Cost</div>
        <div class="text-2xl font-bold font-mono">${(pricing.output * 1000).toFixed(2)}</div>
        <div class="text-xs text-gray-500">per 1K tokens</div>
      </div>
    </section>

    <!-- Pricing Details -->
    <section class="model-card p-6 mb-8">
      <h2 class="text-xl font-bold font-display mb-4">API Pricing Details</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b-2 border-gray-200">
              <th class="text-left py-2 font-mono">Token Type</th>
              <th class="text-right py-2 font-mono">Cost per 1K tokens</th>
              <th class="text-right py-2 font-mono">Cost per 1M tokens</th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-b border-gray-100">
              <td class="py-2 font-medium">Input</td>
              <td class="text-right font-mono">${(pricing.input * 1000).toFixed(3)}</td>
              <td class="text-right font-mono">${pricing.input.toFixed(2)}</td>
            </tr>
            <tr class="border-b border-gray-100">
              <td class="py-2 font-medium">Output</td>
              <td class="text-right font-mono">${(pricing.output * 1000).toFixed(3)}</td>
              <td class="text-right font-mono">${pricing.output.toFixed(2)}</td>
            </tr>
            <tr class="pricing-highlight">
              <td class="py-2 font-medium">Cached</td>
              <td class="text-right font-mono">${(pricing.cached * 1000).toFixed(3)}</td>
              <td class="text-right font-mono">${pricing.cached.toFixed(2)}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Tokenizer Interface -->
    <section class="mb-8">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold font-display">Try {model.displayName} Tokenizer</h2>
        <div class="text-sm text-gray-600">
          Model ID: <span class="font-mono font-bold">{modelId}</span>
        </div>
      </div>

      <!-- Client-side React component for tokenization -->
      <div id="tokenizer-root">
        <ModelTokenizer client:load selectedModel={modelId} />
      </div>
    </section>

    <!-- Model Information -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div class="model-card p-6">
        <h3 class="text-lg font-bold font-display mb-4">Model Information</h3>
        <dl class="space-y-3">
          <div class="flex justify-between">
            <dt class="text-sm text-gray-600">Model Name</dt>
            <dd class="text-sm font-mono font-medium">{model.displayName}</dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-sm text-gray-600">Model ID</dt>
            <dd class="text-sm font-mono font-medium">{modelId}</dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-sm text-gray-600">Encoding</dt>
            <dd class="text-sm font-mono font-medium">{encodingType}</dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-sm text-gray-600">Context Window</dt>
            <dd class="text-sm font-mono font-medium">{model.contextWindow.toLocaleString()} tokens</dd>
          </div>
        </dl>
      </div>

      <div class="model-card p-6">
        <h3 class="text-lg font-bold font-display mb-4">Use Cases</h3>
        <ul class="space-y-2 text-sm">
          <li class="flex items-start">
            <span class="text-brand-orange mr-2">▸</span>
            <span>Optimize prompts for maximum efficiency</span>
          </li>
          <li class="flex items-start">
            <span class="text-brand-orange mr-2">▸</span>
            <span>Estimate API costs before deployment</span>
          </li>
          <li class="flex items-start">
            <span class="text-brand-orange mr-2">▸</span>
            <span>Debug context window limitations</span>
          </li>
          <li class="flex items-start">
            <span class="text-brand-orange mr-2">▸</span>
            <span>Compare token efficiency across models</span>
          </li>
          <li class="flex items-start">
            <span class="text-brand-orange mr-2">▸</span>
            <span>Understand text compression behavior</span>
          </li>
        </ul>
      </div>
    </section>

    <!-- Related Models -->
    <section class="mt-12">
      <h3 class="text-xl font-bold font-display mb-6">Other Models with {encodingType} Encoding</h3>
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {
          Object.entries(MODELS)
            .filter(([_, m]) => m.encoding === encodingType && m.id !== modelId)
            .slice(0, 8)
            .map(([id, m]) => (
              <a
                href={`/models/${id}`}
                class="block p-4 bg-white border-2 border-gray-200 hover:border-brand-orange transition-all duration-200 hover:shadow-md"
              >
                <div class="text-sm font-mono font-medium truncate">{m.displayName}</div>
                <div class="text-xs text-gray-500 mt-1">{m.contextWindow.toLocaleString()} tokens</div>
              </a>
            ))
        }
      </div>
    </section>
  </div>
</MainLayout>